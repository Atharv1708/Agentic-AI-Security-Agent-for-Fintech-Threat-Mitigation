<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THRIDSS · Autonomous Security Command Center</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Exo+2:wght@300;400;600;700;900&display=swap" rel="stylesheet">

<style>
  /* ============================================================
     ROOT VARIABLES & RESET
  ============================================================ */
  :root {
    --bg-deep:       #020810;
    --bg-panel:      #070f1e;
    --bg-panel2:     #0a1628;
    --border:        #1a2d4a;
    --accent-blue:   #0ea5e9;
    --accent-cyan:   #06b6d4;
    --accent-green:  #10b981;
    --accent-red:    #ef4444;
    --accent-orange: #f97316;
    --accent-yellow: #eab308;
    --accent-purple: #8b5cf6;
    --text-primary:  #e2e8f0;
    --text-muted:    #4a6280;
    --text-dim:      #253a52;
    --font-mono:     'Share Tech Mono', monospace;
    --font-main:     'Exo 2', sans-serif;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; }

  body {
    background: var(--bg-deep);
    color: var(--text-primary);
    font-family: var(--font-main);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Grid background texture */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(14,165,233,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(14,165,233,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* Scanline overlay */
  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(
      0deg, transparent, transparent 2px,
      rgba(0,0,0,0.07) 2px, rgba(0,0,0,0.07) 4px
    );
    pointer-events: none;
    z-index: 1;
  }

  /* ============================================================
     LAYOUT
  ============================================================ */
  #app {
    position: relative;
    z-index: 2;
    max-width: 1920px;
    margin: 0 auto;
    padding: 16px 20px 40px;
  }

  /* ============================================================
     PANELS / CARDS
  ============================================================ */
  .panel {
    background: var(--bg-panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 18px;
    position: relative;
    overflow: hidden;
  }

  .panel::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent-blue), transparent);
    opacity: 0.5;
  }

  .panel-title {
    font-family: var(--font-mono);
    font-size: 10px;
    letter-spacing: 0.18em;
    color: var(--text-muted);
    text-transform: uppercase;
    margin-bottom: 10px;
  }

  /* ============================================================
     HEADER BAR
  ============================================================ */
  #header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 20px;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: var(--bg-panel);
    margin-bottom: 16px;
    position: relative;
    overflow: hidden;
  }

  #header::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan), var(--accent-green), var(--accent-blue));
    background-size: 200% 100%;
    animation: headerFlow 4s linear infinite;
  }

  @keyframes headerFlow {
    0%   { background-position: 0% 0%; }
    100% { background-position: 200% 0%; }
  }

  .logo-text {
    font-family: var(--font-mono);
    font-size: 22px;
    letter-spacing: 0.3em;
    color: var(--accent-cyan);
    text-shadow: 0 0 20px rgba(6,182,212,0.6);
  }

  .logo-sub {
    font-family: var(--font-mono);
    font-size: 9px;
    letter-spacing: 0.2em;
    color: var(--text-muted);
    margin-top: 2px;
  }

  .sys-time {
    font-family: var(--font-mono);
    font-size: 20px;
    color: var(--accent-blue);
    letter-spacing: 0.12em;
    text-align: center;
  }

  .sys-date {
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-muted);
    letter-spacing: 0.1em;
    margin-top: 2px;
    text-align: center;
  }

  /* ============================================================
     CONNECTION STATUS BADGE
  ============================================================ */
  #connBadge {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.12em;
    padding: 6px 14px;
    border-radius: 4px;
    border: 1px solid;
    transition: all 0.4s;
  }

  #connBadge.connecting   { color: var(--accent-yellow); border-color: var(--accent-yellow); background: rgba(234,179,8,0.08); animation: blinkYellow 1s infinite; }
  #connBadge.connected    { color: var(--accent-green);  border-color: var(--accent-green);  background: rgba(16,185,129,0.08); }
  #connBadge.disconnected { color: var(--accent-red);    border-color: var(--accent-red);    background: rgba(239,68,68,0.08); animation: blinkRed 0.8s infinite; }

  @keyframes blinkYellow { 0%,100% { opacity:1; } 50% { opacity:0.4; } }
  @keyframes blinkRed    { 0%,100% { opacity:1; } 50% { opacity:0.5; } }

  /* ============================================================
     BIG METRICS
  ============================================================ */
  .big-metric {
    font-family: var(--font-mono);
    font-size: 36px;
    line-height: 1;
    font-weight: 700;
    letter-spacing: 0.04em;
  }

  .small-label {
    font-family: var(--font-mono);
    font-size: 9px;
    letter-spacing: 0.2em;
    color: var(--text-muted);
    text-transform: uppercase;
  }

  /* ============================================================
     RISK INDEX RING
  ============================================================ */
  .risk-ring-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .risk-ring-svg  { width: 110px; height: 110px; transform: rotate(-90deg); }
  .risk-ring-bg   { fill: none; stroke: var(--bg-panel2); stroke-width: 10; }
  .risk-ring-arc  { fill: none; stroke-width: 10; stroke-linecap: round; transition: stroke-dashoffset 0.6s, stroke 0.4s; }

  .risk-value-label {
    font-family: var(--font-mono);
    font-size: 28px;
    font-weight: 700;
    letter-spacing: 0.05em;
    transition: color 0.4s;
  }

  /* ============================================================
     TIER BADGE + BARS
  ============================================================ */
  .tier-badge {
    font-family: var(--font-mono);
    font-size: 30px;
    font-weight: 700;
    letter-spacing: 0.06em;
    padding: 8px 0;
    text-align: center;
    transition: color 0.4s;
  }

  .tier-badge.t5 { animation: pulseRed 1.2s infinite; }

  @keyframes pulseRed {
    0%,100% { text-shadow: 0 0 8px var(--accent-red), 0 0 20px var(--accent-red); }
    50%      { text-shadow: 0 0 30px var(--accent-red), 0 0 60px rgba(239,68,68,0.4); }
  }

  .tier-bars {
    display: flex;
    gap: 4px;
    align-items: flex-end;
    height: 44px;
    margin-top: 6px;
  }

  .tier-bar { flex:1; border-radius:2px; transition:opacity 0.5s,box-shadow 0.5s; opacity:0.15; }
  .tier-bar.active { opacity: 1; }
  .tier-bar.t1 { height:20%; background:var(--accent-green); }
  .tier-bar.t2 { height:40%; background:var(--accent-cyan); }
  .tier-bar.t3 { height:60%; background:var(--accent-yellow); }
  .tier-bar.t4 { height:80%; background:var(--accent-orange); }
  .tier-bar.t5 { height:100%; background:var(--accent-red); }
  .tier-bar.t5.active { animation: pulseBarRed 1.2s infinite; }

  @keyframes pulseBarRed {
    0%,100% { box-shadow:0 0 6px var(--accent-red); }
    50%      { box-shadow:0 0 24px var(--accent-red); }
  }

  .tier-labels { display:flex; gap:4px; margin-top:4px; }
  .tier-labels span { flex:1; font-family:var(--font-mono); font-size:8px; text-align:center; color:var(--text-muted); letter-spacing:0.1em; }

  /* ============================================================
     THRIDSS COMPLIANCE BARS
  ============================================================ */
  .compliance-item { margin-bottom: 11px; }
  .compliance-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:4px; }
  .compliance-key  { font-family:var(--font-mono); font-size:10px; letter-spacing:0.12em; color:var(--text-primary); }
  .compliance-pct  { font-family:var(--font-mono); font-size:10px; color:var(--accent-cyan); }
  .compliance-track { height:4px; background:var(--bg-panel2); border-radius:2px; overflow:hidden; border:1px solid var(--border); }
  .compliance-fill  { height:100%; border-radius:2px; transition:width 1.2s ease; }

  /* ============================================================
     ANIMATED BORDER PANEL
  ============================================================ */
  .panel-anim {
    background: var(--bg-panel);
    border-radius: 6px;
    padding: 18px;
    position: relative;
    overflow: hidden;
  }

  .panel-anim::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 6px;
    padding: 1px;
    background: linear-gradient(120deg, var(--accent-blue), var(--accent-purple), var(--accent-cyan), var(--accent-blue));
    background-size: 300% 300%;
    animation: gradientBorder 5s linear infinite;
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
  }

  @keyframes gradientBorder {
    0%   { background-position:0% 50%; }
    50%  { background-position:100% 50%; }
    100% { background-position:0% 50%; }
  }

  /* ============================================================
     FEED TABLE
  ============================================================ */
  .feed-scroll {
    max-height: 340px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .feed-scroll::-webkit-scrollbar       { width: 5px; }
  .feed-scroll::-webkit-scrollbar-track { background: transparent; }
  .feed-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  .feed-table { width:100%; border-collapse:collapse; font-family:var(--font-mono); font-size:11px; }

  .feed-table thead th {
    padding: 8px 10px;
    text-align: left;
    color: var(--text-muted);
    border-bottom: 1px solid var(--border);
    letter-spacing: 0.12em;
    font-size: 9px;
    position: sticky;
    top: 0;
    background: var(--bg-panel);
    z-index: 2;
  }

  .feed-table tbody tr {
    border-bottom: 1px solid rgba(26,45,74,0.5);
    transition: background 0.2s;
  }

  .feed-table tbody tr:hover { background: rgba(14,165,233,0.04); }
  .feed-table tbody td { padding: 7px 10px; color: var(--text-primary); }

  .sev-badge { display:inline-block; padding:2px 7px; border-radius:3px; font-size:9px; letter-spacing:0.1em; font-weight:600; }
  .sev-CRITICAL { background:rgba(239,68,68,0.15);  color:#f87171; border:1px solid rgba(239,68,68,0.3); }
  .sev-HIGH     { background:rgba(249,115,22,0.15); color:#fb923c; border:1px solid rgba(249,115,22,0.3); }
  .sev-MEDIUM   { background:rgba(234,179,8,0.12);  color:#facc15; border:1px solid rgba(234,179,8,0.3); }
  .sev-LOW      { background:rgba(16,185,129,0.12); color:#34d399; border:1px solid rgba(16,185,129,0.3); }

  /* ============================================================
     AI REASON LOG
  ============================================================ */
  .ai-reason-scroll {
    max-height: 148px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .ai-reason-scroll::-webkit-scrollbar       { width:4px; }
  .ai-reason-scroll::-webkit-scrollbar-thumb { background:var(--border); }

  .ai-entry {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--text-primary);
    padding: 5px 0;
    border-bottom: 1px solid rgba(26,45,74,0.4);
    line-height: 1.5;
  }

  .ai-entry .ai-time { color:var(--accent-cyan); margin-right:8px; }
  .ai-entry .ai-text { color:#7ca9cc; }

  /* ============================================================
     SECTION DIVIDER
  ============================================================ */
  .section-label {
    font-family: var(--font-mono);
    font-size: 9px;
    letter-spacing: 0.25em;
    color: var(--text-dim);
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 14px 0 10px;
  }

  .section-label::before,
  .section-label::after { content:''; flex:1; height:1px; background:var(--border); }

  /* Row fade-in */
  @keyframes fadeInRow {
    from { opacity:0; background:rgba(14,165,233,0.08); }
    to   { opacity:1; background:transparent; }
  }

  .row-new { animation: fadeInRow 0.5s ease; }

  /* Chart containers */
  .chart-wrap { position:relative; width:100%; }

  /* Glow */
  .glow-blue  { box-shadow:0 0 20px rgba(14,165,233,0.12); }
</style>
</head>

<body>
<div id="app">

  <!-- ============================================================
       HEADER BAR
  ============================================================ -->
  <div id="header">
    <div>
      <div class="logo-text">THRIDSS</div>
      <div class="logo-sub">Autonomous Fintech Threat Defense Grid &nbsp;·&nbsp; Hybrid LSTM + DRL + Dempster-Shafer &nbsp;·&nbsp; v4.2.1</div>
    </div>

    <div>
      <div class="sys-time" id="sysTime">00:00:00</div>
      <div class="sys-date" id="sysDate">--</div>
    </div>

    <div style="display:flex;align-items:center;gap:14px;">
      <div style="text-align:right;">
        <div style="font-family:var(--font-mono);font-size:9px;color:var(--text-muted);letter-spacing:0.15em;">AI ENGINE</div>
        <div id="aiEngineHeader" style="font-family:var(--font-mono);font-size:12px;color:var(--accent-green);letter-spacing:0.1em;">INITIALIZING</div>
      </div>
      <div id="connBadge" class="connecting">&#9679; CONNECTING</div>
    </div>
  </div>

  <!-- ============================================================
       SECTION — CORE TELEMETRY
  ============================================================ -->
  <div class="section-label">Core Defense Telemetry</div>

  <!-- Row 1a: Risk + Tier + 4 counters -->
  <div style="display:grid;grid-template-columns:195px 215px repeat(4,1fr);gap:12px;margin-bottom:12px;">

    <!-- GLOBAL RISK INDEX -->
    <div class="panel-anim glow-blue" style="padding:16px;">
      <div class="panel-title">Global Risk Index</div>
      <div class="risk-ring-wrap">
        <svg class="risk-ring-svg" viewBox="0 0 120 120">
          <circle class="risk-ring-bg" cx="60" cy="60" r="50"/>
          <circle id="riskArc" class="risk-ring-arc" cx="60" cy="60" r="50"
            stroke="#10b981" stroke-dasharray="314" stroke-dashoffset="267"/>
        </svg>
        <div style="margin-top:-76px;margin-bottom:22px;text-align:center;position:relative;z-index:1;">
          <div id="riskValue" class="risk-value-label" style="color:var(--accent-green);">15</div>
          <div style="font-family:var(--font-mono);font-size:8px;color:var(--text-muted);letter-spacing:0.12em;">/ 100</div>
        </div>
      </div>
      <div style="font-family:var(--font-mono);font-size:9px;color:var(--text-muted);text-align:center;letter-spacing:0.1em;" id="riskLabel">NOMINAL</div>
    </div>

    <!-- ESCALATION TIER -->
    <div class="panel">
      <div class="panel-title">Escalation Tier</div>
      <div id="tierBadge" class="tier-badge" style="color:var(--accent-green);">TIER 1</div>
      <div class="tier-bars">
        <div class="tier-bar t1 active" id="tb1"></div>
        <div class="tier-bar t2" id="tb2"></div>
        <div class="tier-bar t3" id="tb3"></div>
        <div class="tier-bar t4" id="tb4"></div>
        <div class="tier-bar t5" id="tb5"></div>
      </div>
      <div class="tier-labels">
        <span>T1</span><span>T2</span><span>T3</span><span>T4</span><span>T5</span>
      </div>
    </div>

    <!-- TOTAL ATTACKS -->
    <div class="panel" style="text-align:center;">
      <div class="panel-title">Total Attacks</div>
      <div id="totalAttacks" class="big-metric" style="color:var(--accent-red);margin-top:8px;">0</div>
      <div class="small-label" style="margin-top:8px;">Blocked Events</div>
    </div>

    <!-- TOP ATTACKER IP -->
    <div class="panel" style="text-align:center;">
      <div class="panel-title">Top Attacker IP</div>
      <div id="topAttackerIP" class="big-metric" style="color:var(--accent-orange);font-size:18px;margin-top:14px;word-break:break-all;">N/A</div>
      <div class="small-label" style="margin-top:8px;" id="topAttackerCount">0 hits</div>
    </div>

    <!-- REQUESTS / MIN -->
    <div class="panel" style="text-align:center;">
      <div class="panel-title">Requests / Min</div>
      <div id="reqPerMin" class="big-metric" style="color:var(--accent-blue);margin-top:8px;">0</div>
      <div class="small-label" style="margin-top:8px;">Ingress Rate</div>
    </div>

    <!-- THREAT EVENTS / MIN -->
    <div class="panel" style="text-align:center;">
      <div class="panel-title">Threat Events / Min</div>
      <div id="threatPerMin" class="big-metric" style="color:var(--accent-red);margin-top:8px;">0</div>
      <div class="small-label" style="margin-top:8px;">Anomaly Rate</div>
    </div>

  </div>

  <!-- Row 1b: WS clients + AI status + Decay model -->
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:12px;">

    <div class="panel" style="text-align:center;">
      <div class="panel-title">Active Dashboards</div>
      <div id="wsClients" class="big-metric" style="color:var(--accent-purple);margin-top:6px;">0</div>
      <div class="small-label" style="margin-top:6px;">WebSocket Connections</div>
    </div>

    <div class="panel" style="text-align:center;">
      <div class="panel-title">AI Engine Status</div>
      <div id="aiStatusPanel" class="big-metric" style="color:var(--text-muted);font-size:22px;margin-top:10px;letter-spacing:0.08em;">UNKNOWN</div>
      <div class="small-label" style="margin-top:8px;">Hybrid LSTM · DRL · Dempster-Shafer</div>
    </div>

    <div class="panel">
      <div class="panel-title">Risk Decay Model &nbsp;·&nbsp; Auto-Mitigation Engine</div>
      <div style="margin-top:8px;">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
          <span style="font-family:var(--font-mono);font-size:9px;color:var(--text-muted);">DECAY RATE</span>
          <span id="decayRateLabel" style="font-family:var(--font-mono);font-size:9px;color:var(--accent-cyan);">-1 pt / 5s</span>
        </div>
        <div class="compliance-track" style="height:6px;">
          <div id="decayBar" class="compliance-fill" style="width:85%;background:linear-gradient(90deg,var(--accent-green),var(--accent-cyan));"></div>
        </div>
        <div style="font-family:var(--font-mono);font-size:9px;color:var(--text-muted);margin-top:8px;line-height:1.6;">
          Rolling SOC mitigation active. Risk floor: 15. Decay accelerates during quiet periods.
        </div>
      </div>
    </div>

  </div>

  <!-- ============================================================
       SECTION — ANALYTICS
  ============================================================ -->
  <div class="section-label">Analytics &amp; Threat Intelligence</div>

  <!-- Trend + Severity -->
  <div style="display:grid;grid-template-columns:2fr 1fr;gap:12px;margin-bottom:12px;">

    <div class="panel glow-blue">
      <div class="panel-title">Live Threat Timeline &nbsp;·&nbsp; Events per Interval</div>
      <div class="chart-wrap" style="height:200px;">
        <canvas id="trendChart"></canvas>
      </div>
    </div>

    <div class="panel">
      <div class="panel-title">Severity Distribution</div>
      <div class="chart-wrap" style="height:165px;">
        <canvas id="severityChart"></canvas>
      </div>
      <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap;">
        <div style="font-family:var(--font-mono);font-size:9px;"><span style="color:#f87171;">&#9632;</span> CRIT <span id="sevCritical" style="color:#f87171;">0</span></div>
        <div style="font-family:var(--font-mono);font-size:9px;"><span style="color:#fb923c;">&#9632;</span> HIGH <span id="sevHigh" style="color:#fb923c;">0</span></div>
        <div style="font-family:var(--font-mono);font-size:9px;"><span style="color:#facc15;">&#9632;</span> MED  <span id="sevMedium" style="color:#facc15;">0</span></div>
        <div style="font-family:var(--font-mono);font-size:9px;"><span style="color:#34d399;">&#9632;</span> LOW  <span id="sevLow" style="color:#34d399;">0</span></div>
      </div>
    </div>

  </div>

  <!-- Cluster + Confidence -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">

    <div class="panel">
      <div class="panel-title">Attack Type Clustering &nbsp;·&nbsp; Frequency Distribution</div>
      <div class="chart-wrap" style="height:200px;">
        <canvas id="clusterChart"></canvas>
      </div>
    </div>

    <div class="panel">
      <div class="panel-title">Dempster-Shafer Confidence Fusion Gauge</div>
      <div style="display:flex;align-items:center;gap:20px;margin-top:4px;">
        <div class="chart-wrap" style="height:155px;width:210px;flex-shrink:0;">
          <canvas id="confidenceGauge"></canvas>
        </div>
        <div>
          <div id="confidencePct" style="font-family:var(--font-mono);font-size:44px;font-weight:700;color:var(--accent-cyan);">50%</div>
          <div style="font-family:var(--font-mono);font-size:9px;color:var(--text-muted);margin-top:4px;letter-spacing:0.1em;">MODEL CERTAINTY</div>
          <div style="font-family:var(--font-mono);font-size:9px;color:var(--text-muted);margin-top:10px;line-height:1.7;">
            Fuses LSTM probability,<br>DRL Q-value signal,<br>D-S belief function.
          </div>
          <div class="compliance-track" style="height:6px;width:150px;margin-top:12px;">
            <div id="confidenceFill" class="compliance-fill" style="width:50%;background:linear-gradient(90deg,var(--accent-blue),var(--accent-cyan));"></div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- ============================================================
       SECTION — THRIDSS GOVERNANCE
  ============================================================ -->
  <div class="section-label">THRIDSS Governance &nbsp;·&nbsp; KPI Compliance Dashboard</div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">

    <!-- COMPLIANCE PANEL -->
    <div class="panel">
      <div class="panel-title">THRIDSS Principle Compliance &nbsp;·&nbsp; Live KPI Scores</div>
      <div style="margin-top:6px;">

        <div class="compliance-item">
          <div class="compliance-header">
            <span class="compliance-key">T &nbsp;·&nbsp; TRANSPARENCY</span>
            <span class="compliance-pct" id="kpi-T">--</span>
          </div>
          <div class="compliance-track">
            <div class="compliance-fill" id="bar-T" style="width:0%;background:linear-gradient(90deg,#0ea5e9,#38bdf8);"></div>
          </div>
        </div>

        <div class="compliance-item">
          <div class="compliance-header">
            <span class="compliance-key">H &nbsp;·&nbsp; HUMAN CONTROL</span>
            <span class="compliance-pct" id="kpi-H">--</span>
          </div>
          <div class="compliance-track">
            <div class="compliance-fill" id="bar-H" style="width:0%;background:linear-gradient(90deg,#8b5cf6,#a78bfa);"></div>
          </div>
        </div>

        <div class="compliance-item">
          <div class="compliance-header">
            <span class="compliance-key">R &nbsp;·&nbsp; ROBUSTNESS</span>
            <span class="compliance-pct" id="kpi-R">--</span>
          </div>
          <div class="compliance-track">
            <div class="compliance-fill" id="bar-R" style="width:0%;background:linear-gradient(90deg,#10b981,#34d399);"></div>
          </div>
        </div>

        <div class="compliance-item">
          <div class="compliance-header">
            <span class="compliance-key">I &nbsp;·&nbsp; INTERPRETABILITY</span>
            <span class="compliance-pct" id="kpi-I">--</span>
          </div>
          <div class="compliance-track">
            <div class="compliance-fill" id="bar-I" style="width:0%;background:linear-gradient(90deg,#06b6d4,#22d3ee);"></div>
          </div>
        </div>

        <div class="compliance-item">
          <div class="compliance-header">
            <span class="compliance-key">D &nbsp;·&nbsp; DATA PRIVACY</span>
            <span class="compliance-pct" id="kpi-D">--</span>
          </div>
          <div class="compliance-track">
            <div class="compliance-fill" id="bar-D" style="width:0%;background:linear-gradient(90deg,#f59e0b,#fbbf24);"></div>
          </div>
        </div>

        <div class="compliance-item">
          <div class="compliance-header">
            <span class="compliance-key">S &nbsp;·&nbsp; SECURITY</span>
            <span class="compliance-pct" id="kpi-S">--</span>
          </div>
          <div class="compliance-track">
            <div class="compliance-fill" id="bar-S" style="width:0%;background:linear-gradient(90deg,#ef4444,#f87171);"></div>
          </div>
        </div>

        <div class="compliance-item" style="margin-bottom:0;">
          <div class="compliance-header">
            <span class="compliance-key">SC &nbsp;·&nbsp; SCALABILITY</span>
            <span class="compliance-pct" id="kpi-SC">--</span>
          </div>
          <div class="compliance-track">
            <div class="compliance-fill" id="bar-SC" style="width:0%;background:linear-gradient(90deg,#6366f1,#818cf8);"></div>
          </div>
        </div>

      </div>
    </div>

    <!-- AI REASONING TIMELINE -->
    <div class="panel">
      <div class="panel-title">AI Threat Reasoning Timeline &nbsp;·&nbsp; LLM Explanations</div>
      <div class="ai-reason-scroll" id="aiReasonScroll">
        <div class="ai-entry">
          <span class="ai-time">INIT</span>
          <span class="ai-text">System initialized. Awaiting first threat signal from detection pipeline…</span>
        </div>
      </div>
    </div>

  </div>

  <!-- ============================================================
       SECTION — LIVE THREAT FEED
  ============================================================ -->
  <div class="section-label">Real-Time Threat Feed &nbsp;·&nbsp; Auto-Trim at 300 Events</div>

  <div class="panel">
    <div class="panel-title">Live Attack Log &nbsp;·&nbsp; Streaming Events</div>
    <div class="feed-scroll">
      <table class="feed-table">
        <thead>
          <tr>
            <th>TIME</th>
            <th>ATTACK TYPE</th>
            <th>SOURCE IP</th>
            <th>SEVERITY</th>
            <th>CONFIDENCE</th>
            <th>AI SIGNAL</th>
          </tr>
        </thead>
        <tbody id="feedBody">
          <tr>
            <td colspan="6" style="text-align:center;padding:24px;color:var(--text-muted);font-family:var(--font-mono);letter-spacing:0.1em;font-size:10px;">
              &#9711; Monitoring active &mdash; awaiting threat events&hellip;
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- FOOTER -->
  <div style="margin-top:20px;text-align:center;font-family:var(--font-mono);font-size:9px;color:var(--text-dim);letter-spacing:0.15em;">
    THRIDSS AUTONOMOUS SECURITY GRID &nbsp;&middot;&nbsp; FINTECH THREAT SHIELD &nbsp;&middot;&nbsp; ALL SYSTEMS OPERATIONAL &nbsp;&middot;&nbsp; CLASSIFIED
  </div>

</div><!-- /#app -->


<script>
/* ============================================================
   STATE ENGINE
============================================================ */
let riskIndex      = 15;
let totalAttacks   = 0;
let attackerMap    = {};
let clusterMap     = {};
let severityCounts = { CRITICAL: 0, HIGH: 0, MEDIUM: 0, LOW: 0 };
let ws             = null;
let wsReconnTimer  = null;

// THRIDSS Governance KPI scores (realistic baselines)
const kpiScores = {
  T:  88,   // Transparency
  H:  92,   // Human Control
  R:  79,   // Robustness
  I:  74,   // Interpretability
  D:  95,   // Data Privacy
  S:  83,   // Security
  SC: 91    // Scalability
};

/* ============================================================
   REAL-TIME CLOCK
============================================================ */
function updateClock() {
  const now  = new Date();
  document.getElementById('sysTime').textContent = now.toLocaleTimeString('en-US', { hour12: false });
  document.getElementById('sysDate').textContent  = now.toLocaleDateString('en-US', {
    weekday: 'short', year: 'numeric', month: 'short', day: 'numeric'
  });
}
setInterval(updateClock, 1000);
updateClock();

/* ============================================================
   CHART REFERENCES
============================================================ */
let trendChart, severityChart, clusterChart, confidenceGauge;

/* ============================================================
   CHART INITIALIZATION
============================================================ */
function initCharts() {
  const baseOpts = {
    responsive: true,
    maintainAspectRatio: false,
    animation: { duration: 350 },
    plugins: { legend: { display: false } }
  };

  const axisStyle = {
    ticks: { color: '#4a6280', font: { family: "'Share Tech Mono'", size: 9 } },
    grid:  { color: 'rgba(26,45,74,0.45)' }
  };

  /* -- Trend Timeline -- */
  trendChart = new Chart(document.getElementById('trendChart'), {
    type: 'line',
    data: {
      labels: [],
      datasets: [
        {
          label: 'All Events',
          data: [],
          borderColor: '#0ea5e9',
          backgroundColor: 'rgba(14,165,233,0.07)',
          fill: true,
          tension: 0.45,
          pointRadius: 3,
          pointBackgroundColor: '#0ea5e9',
          borderWidth: 2
        },
        {
          label: 'Critical',
          data: [],
          borderColor: '#ef4444',
          backgroundColor: 'rgba(239,68,68,0.05)',
          fill: true,
          tension: 0.45,
          pointRadius: 2,
          borderWidth: 1.5
        }
      ]
    },
    options: {
      ...baseOpts,
      scales: {
        x: { ...axisStyle, ticks: { ...axisStyle.ticks, maxTicksLimit: 8 } },
        y: { ...axisStyle, beginAtZero: true }
      },
      plugins: {
        legend: {
          display: true,
          labels: { color: '#4a6280', font: { family: "'Share Tech Mono'", size: 9 }, boxWidth: 10 }
        }
      }
    }
  });

  /* -- Severity Doughnut -- */
  severityChart = new Chart(document.getElementById('severityChart'), {
    type: 'doughnut',
    data: {
      labels: ['CRITICAL','HIGH','MEDIUM','LOW'],
      datasets: [{
        data: [0,0,0,0],
        backgroundColor: ['#ef4444','#f97316','#eab308','#10b981'],
        borderColor: '#070f1e',
        borderWidth: 3
      }]
    },
    options: { ...baseOpts, cutout: '68%' }
  });

  /* -- Attack Cluster Bar -- */
  clusterChart = new Chart(document.getElementById('clusterChart'), {
    type: 'bar',
    data: {
      labels: [],
      datasets: [{
        label: 'Frequency',
        data: [],
        backgroundColor: 'rgba(99,102,241,0.55)',
        borderColor: '#6366f1',
        borderWidth: 1,
        borderRadius: 3
      }]
    },
    options: {
      ...baseOpts,
      scales: {
        x: { ...axisStyle },
        y: { ...axisStyle, beginAtZero: true }
      }
    }
  });

  /* -- Confidence Semi-Doughnut -- */
  confidenceGauge = new Chart(document.getElementById('confidenceGauge'), {
    type: 'doughnut',
    data: {
      labels: ['Confidence','Remaining'],
      datasets: [{
        data: [50,50],
        backgroundColor: ['#38bdf8','#0a1628'],
        borderColor:      ['#0ea5e9','#0a1628'],
        borderWidth: 2
      }]
    },
    options: {
      ...baseOpts,
      rotation: -90,
      circumference: 180,
      plugins: { legend: { display: false } }
    }
  });
}

/* ============================================================
   RISK ENGINE — scoring & visual update
============================================================ */
function applyRiskIncrement(severity) {
  const inc = { CRITICAL: 6, HIGH: 4, MEDIUM: 2, LOW: 1 };
  riskIndex  = Math.min(100, riskIndex + (inc[severity] || 1));
  renderRisk();
}

function renderRisk() {
  const circumference = 314;
  const offset        = circumference - (circumference * (riskIndex / 100));

  document.getElementById('riskArc').setAttribute('stroke-dashoffset', offset.toFixed(2));
  document.getElementById('riskValue').textContent = Math.round(riskIndex);

  let color, tier, tierColor, labelText, tierClass, tierNum;

  if      (riskIndex <= 20) { color='#10b981'; tier='TIER 1'; tierColor='#10b981'; labelText='NOMINAL';        tierClass='';   tierNum=1; }
  else if (riskIndex <= 40) { color='#06b6d4'; tier='TIER 2'; tierColor='#06b6d4'; labelText='ELEVATED';       tierClass='';   tierNum=2; }
  else if (riskIndex <= 60) { color='#eab308'; tier='TIER 3'; tierColor='#eab308'; labelText='HIGH RISK';      tierClass='';   tierNum=3; }
  else if (riskIndex <= 80) { color='#f97316'; tier='TIER 4'; tierColor='#f97316'; labelText='CRITICAL STATE'; tierClass='';   tierNum=4; }
  else                      { color='#ef4444'; tier='TIER 5'; tierColor='#ef4444'; labelText='MAX THREAT';     tierClass='t5'; tierNum=5; }

  document.getElementById('riskArc').setAttribute('stroke', color);
  document.getElementById('riskValue').style.color       = color;
  document.getElementById('riskLabel').textContent        = labelText;
  const badge = document.getElementById('tierBadge');
  badge.textContent  = tier;
  badge.style.color  = tierColor;
  badge.className    = 'tier-badge ' + tierClass;

  // Update tier bars
  for (let i = 1; i <= 5; i++) {
    const bar = document.getElementById('tb' + i);
    bar.classList.toggle('active', i <= tierNum);
  }
}

/* ============================================================
   RISK AUTO-DECAY (SOC realism — slow mitigation)
============================================================ */
setInterval(() => {
  if (riskIndex > 15) {
    riskIndex = Math.max(15, riskIndex - 1);
    renderRisk();
  }
}, 5000);

/* ============================================================
   COMPLIANCE KPI ENGINE
============================================================ */
function renderKPI() {
  ['T','H','R','I','D','S','SC'].forEach(k => {
    const pct = Math.round(kpiScores[k]);
    document.getElementById('kpi-' + k).textContent  = pct + '%';
    document.getElementById('bar-' + k).style.width  = pct + '%';
  });
}

// Organic drift — slight realistic fluctuation
function driftKPI() {
  ['T','H','R','I','D','S','SC'].forEach(k => {
    const delta   = (Math.random() - 0.42) * 1.8;
    kpiScores[k]  = Math.min(100, Math.max(48, kpiScores[k] + delta));
  });
  renderKPI();
}
setInterval(driftKPI, 9000);

/* ============================================================
   AI REASONING PANEL
============================================================ */
function appendAIReason(timeStr, reason, sev) {
  const container = document.getElementById('aiReasonScroll');
  const entry     = document.createElement('div');
  entry.className = 'ai-entry';

  const sevColors = { CRITICAL:'#f87171', HIGH:'#fb923c', MEDIUM:'#facc15', LOW:'#34d399' };
  const sc        = sevColors[sev] || '#4a6280';

  entry.innerHTML =
    '<span class="ai-time">' + timeStr + '</span>' +
    '<span style="color:' + sc + ';font-size:9px;margin-right:6px;">[' + sev + ']</span>' +
    '<span class="ai-text">' + escapeHTML(reason) + '</span>';

  container.insertBefore(entry, container.firstChild);
  while (container.children.length > 80) container.removeChild(container.lastChild);
}

/* ============================================================
   FEED TABLE ROW
============================================================ */
function appendFeedRow(data, timeStr, type, ip, sev, confPct) {
  const tbody = document.getElementById('feedBody');

  // Remove placeholder row
  if (tbody.firstElementChild && tbody.firstElementChild.querySelector('[colspan]')) {
    tbody.innerHTML = '';
  }

  const tr      = document.createElement('tr');
  tr.className  = 'row-new';

  const confColor = confPct >= 80 ? 'var(--accent-green)' : confPct >= 50 ? 'var(--accent-cyan)' : 'var(--accent-red)';
  const signal    = escapeHTML((data.llm_reason || 'Anomaly pattern detected.').substring(0, 58)) + '&hellip;';

  tr.innerHTML =
    '<td style="color:var(--text-muted);white-space:nowrap;">'              + escapeHTML(timeStr) + '</td>' +
    '<td style="color:var(--accent-blue);">'                                + escapeHTML(type)    + '</td>' +
    '<td style="color:var(--text-primary);font-family:var(--font-mono);">'  + escapeHTML(ip)      + '</td>' +
    '<td><span class="sev-badge sev-' + sev + '">' + sev + '</span></td>'                                   +
    '<td style="color:' + confColor + ';">'         + confPct + '%</td>'                                    +
    '<td style="color:#4a6280;font-size:10px;">'    + signal  + '</td>';

  tbody.insertBefore(tr, tbody.firstChild);
  while (tbody.children.length > 300) tbody.removeChild(tbody.lastChild);
}

/* ============================================================
   ATTACK HANDLER — processes attack_detected messages
============================================================ */
function handleAttack(data) {
  totalAttacks++;
  document.getElementById('totalAttacks').textContent = totalAttacks.toLocaleString();

  // Top attacker tracking
  const ip                = data.ip || '0.0.0.0';
  attackerMap[ip]         = (attackerMap[ip] || 0) + 1;
  const topIP             = Object.keys(attackerMap).reduce((a, b) => attackerMap[a] > attackerMap[b] ? a : b);
  document.getElementById('topAttackerIP').textContent    = topIP;
  document.getElementById('topAttackerCount').textContent = attackerMap[topIP] + ' hits';

  // Attack clustering bar chart
  const type              = data.attack_type || 'UNKNOWN';
  clusterMap[type]        = (clusterMap[type] || 0) + 1;
  clusterChart.data.labels            = Object.keys(clusterMap);
  clusterChart.data.datasets[0].data  = Object.values(clusterMap);
  clusterChart.update('none');

  // Severity doughnut
  const sev = data.severity || 'LOW';
  if (severityCounts[sev] !== undefined) severityCounts[sev]++;
  severityChart.data.datasets[0].data = [
    severityCounts.CRITICAL, severityCounts.HIGH, severityCounts.MEDIUM, severityCounts.LOW
  ];
  severityChart.update('none');
  document.getElementById('sevCritical').textContent = severityCounts.CRITICAL;
  document.getElementById('sevHigh').textContent     = severityCounts.HIGH;
  document.getElementById('sevMedium').textContent   = severityCounts.MEDIUM;
  document.getElementById('sevLow').textContent      = severityCounts.LOW;

  // Trend timeline (rolling 30 points)
  const label = new Date(data.timestamp || Date.now()).toLocaleTimeString('en-US', { hour12: false });

  if (trendChart.data.labels.length >= 30) {
    trendChart.data.labels.shift();
    trendChart.data.datasets[0].data.shift();
    trendChart.data.datasets[1].data.shift();
  }
  trendChart.data.labels.push(label);
  trendChart.data.datasets[0].data.push(1);
  trendChart.data.datasets[1].data.push(sev === 'CRITICAL' ? 1 : 0);
  trendChart.update('none');

  // Confidence gauge
  const conf    = typeof data.confidence === 'number' ? data.confidence : 0.5;
  const confPct = Math.round(conf * 100);
  confidenceGauge.data.datasets[0].data = [confPct, 100 - confPct];

  // Dynamic color based on certainty
  let cfColor = '#38bdf8';
  if      (confPct >= 85) cfColor = '#10b981';
  else if (confPct >= 65) cfColor = '#0ea5e9';
  else if (confPct >= 45) cfColor = '#eab308';
  else                    cfColor = '#ef4444';

  confidenceGauge.data.datasets[0].backgroundColor[0] = cfColor;
  confidenceGauge.data.datasets[0].borderColor[0]     = cfColor;
  confidenceGauge.update('none');
  document.getElementById('confidencePct').textContent  = confPct + '%';
  document.getElementById('confidencePct').style.color  = cfColor;
  document.getElementById('confidenceFill').style.width = confPct + '%';
  document.getElementById('confidenceFill').style.background = cfColor;

  // AI reasoning
  const reason = data.llm_reason || 'Hybrid LSTM-DRL model flagged anomalous pattern in transaction flow.';
  appendAIReason(label, reason, sev);

  // Feed table
  appendFeedRow(data, label, type, ip, sev, confPct);

  // Risk engine
  applyRiskIncrement(sev);

  // KPI impact on critical events
  if (sev === 'CRITICAL') {
    kpiScores.S  = Math.max(48, kpiScores.S  - 2.5);
    kpiScores.R  = Math.max(48, kpiScores.R  - 1.5);
    kpiScores.SC = Math.max(48, kpiScores.SC - 1.0);
    renderKPI();
  } else if (sev === 'HIGH') {
    kpiScores.S  = Math.max(48, kpiScores.S  - 1.0);
    renderKPI();
  }
}

/* ============================================================
   METRICS HANDLER — processes metrics_update messages
============================================================ */
function handleMetrics(data) {
  document.getElementById('reqPerMin').textContent    = (data.requests_per_minute     || 0).toLocaleString();
  document.getElementById('threatPerMin').textContent = (data.error_events_per_minute || 0).toLocaleString();
  document.getElementById('wsClients').textContent    = (data.active_ws_clients       || 0);

  const aiStatus = ((data.llm_status || 'UNKNOWN') + '').toUpperCase();
  let aiColor    = '#94a3b8';
  if      (aiStatus === 'ACTIVE')    aiColor = '#10b981';
  else if (aiStatus === 'DEGRADED')  aiColor = '#eab308';
  else if (aiStatus === 'OFFLINE')   aiColor = '#ef4444';

  document.getElementById('aiStatusPanel').textContent  = aiStatus;
  document.getElementById('aiStatusPanel').style.color  = aiColor;
  document.getElementById('aiEngineHeader').textContent = aiStatus;
  document.getElementById('aiEngineHeader').style.color = aiColor;
}

/* ============================================================
   WEBSOCKET ENGINE — connect / auto-reconnect
============================================================ */
function connectWS() {
  if (wsReconnTimer) { clearTimeout(wsReconnTimer); wsReconnTimer = null; }

  const proto = location.protocol === 'https:' ? 'wss:' : 'ws:';
  const url   = proto + '//' + location.host + '/ws';

  setBadge('connecting');

  try {
    ws = new WebSocket(url);
  } catch (e) {
    console.warn('[THRIDSS] WS construction failed:', e);
    scheduleReconnect();
    return;
  }

  ws.onopen = () => {
    setBadge('connected');
    appendAIReason(
      new Date().toLocaleTimeString('en-US', { hour12: false }),
      'WebSocket connection established. Autonomous defense grid online and monitoring.',
      'LOW'
    );
  };

  ws.onclose = () => {
    setBadge('disconnected');
    scheduleReconnect();
  };

  ws.onerror = (err) => {
    console.warn('[THRIDSS] WS error:', err);
    setBadge('disconnected');
  };

  ws.onmessage = (event) => {
    let msg;
    try     { msg = JSON.parse(event.data); }
    catch (e) { console.warn('[THRIDSS] WS parse error:', e); return; }

    if (msg.type === 'attack_detected') handleAttack(msg);
    if (msg.type === 'metrics_update')  handleMetrics(msg);
  };
}

function scheduleReconnect() {
  if (wsReconnTimer) return;
  wsReconnTimer = setTimeout(() => { wsReconnTimer = null; connectWS(); }, 4000);
}

function setBadge(state) {
  const el = document.getElementById('connBadge');
  if (state === 'connecting')   { el.textContent = '\u25CF CONNECTING';   el.className = 'connecting'; }
  else if (state === 'connected') { el.textContent = '\u25CF CONNECTED';  el.className = 'connected'; }
  else                           { el.textContent = '\u25CF RECONNECTING'; el.className = 'disconnected'; }
}

/* ============================================================
   UTILITY — XSS-safe HTML escaping
============================================================ */
function escapeHTML(str) {
  if (typeof str !== 'string') return '';
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

/* ============================================================
   BOOT SEQUENCE
============================================================ */
document.addEventListener('DOMContentLoaded', () => {
  initCharts();
  renderKPI();
  renderRisk();
  connectWS();
});
</script>

</body>
</html>
